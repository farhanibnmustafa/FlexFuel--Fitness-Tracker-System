<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlexFule â€” Sign Up</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="build/tailwind.css" />
  <link rel="stylesheet" href="signup.css" />
  <link rel="stylesheet" href="theme.css" />
  <script defer src="prompt.js"></script>
  <script defer src="auth.js"></script>
  <link rel="icon" href="images/flexfuel.png" />
  <meta name="color-scheme" content="dark light" />
</head>
<body class="auth-shell">
  <main class="page">
    <a class="back-btn" href="welcome.html" aria-label="Back to Welcome">
      <svg class="icon" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M14.7 5.3a1 1 0 0 1 0 1.4L10.41 11H20a1 1 0 1 1 0 2h-9.59l4.3 4.3a1 1 0 0 1-1.42 1.4l-6-6a1 1 0 0 1 0-1.4l6-6a1 1 0 0 1 1.42 0Z"/></svg>
      <!-- <span class="label">Back</span> -->
    </a>

    <div class="green-beam" aria-hidden="true"></div>

    <header class="brand">
      <div class="halo" aria-hidden="true"></div>
      <div class="logo-disc">
        <img src="images/logoBg.png" alt="FlexFule" />
      </div>
    </header>

    <section class="content">
      <section class="signup-card">
        <form id="signup-step1" class="form" action="#" method="post" novalidate>
          <h2 class="title"><span>Personal Information</span></h2>
          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            </span>
            <input type="text" name="name" placeholder="Name" required />
            <span class="error-message" aria-live="polite"></span>
          </label>

          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 4-8 5L4 8V6l8 5 8-5Z"/></svg>
            </span>
            <input type="email" name="email" placeholder="Email id" autocomplete="email" required />
            <span class="error-message" aria-live="polite"></span>
          </label>

          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 2a7 7 0 1 0 7 7 7.008 7.008 0 0 0-7-7Zm0 12a5 5 0 1 1 5-5 5.006 5.006 0 0 1-5 5ZM5 22a7 7 0 0 1 14 0Z"/></svg>
            </span>
            <input type="number" name="age" min="1" max="120" placeholder="Enter Your Age" required />
            <span class="error-message" aria-live="polite"></span>
          </label>

          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M16 14a4 4 0 1 0-4 4 4 4 0 0 0 4-4ZM6 9a3 3 0 1 0-3-3 3 3 0 0 0 3 3Zm12 0a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z"/></svg>
            </span>
            <select name="gender" required>
              <option value="" disabled selected>Select Your Gender</option>
              <option>Female</option>
              <option>Male</option>
              <option>Non-binary</option>
              <option>Prefer not to say</option>
            </select>
            <span class="error-message" aria-live="polite"></span>
          </label>

          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2Zm-7-2a2 2 0 0 1 4 0v2H10Z"/></svg>
            </span>
            <input type="password" name="password" placeholder="Enter Your Password" autocomplete="new-password" required />
            <span class="error-message" aria-live="polite"></span>
          </label>

          <label class="field">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2Z"/></svg>
            </span>
            <input type="password" name="confirm" placeholder="Confirm Your Password" autocomplete="new-password" required />
            <span class="error-message" aria-live="polite"></span>
          </label>

        </form>
      </section>

      <aside class="aside">
        <figure class="builder">
          <img
            src="images/athlete-abs.jpg"
            alt="Athlete revealing a defined core"
            loading="lazy"
          />
        </figure>
        <a id="to-health" class="next-btn" href="health.html">Next</a>
      </aside>
    </section>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="supabase-browser.js"></script>
  <script src="supabase-session.js"></script>
  <script>
    // Save step 1 to sessionStorage, then navigate to health.html
    const form = document.getElementById('signup-step1');
    const nextLink = document.getElementById('to-health');

    if (form) {
      const fields = {
        name: form.elements.namedItem('name'),
        email: form.elements.namedItem('email'),
        age: form.elements.namedItem('age'),
        gender: form.elements.namedItem('gender'),
        password: form.elements.namedItem('password'),
        confirm: form.elements.namedItem('confirm')
      };

      const inputs = form.querySelectorAll('input, select');

      function clearFieldError(element) {
        const container = element.closest('.field');
        if (!container) return;
        container.classList.remove('error');
        const message = container.querySelector('.error-message');
        if (message) message.textContent = '';
        element.removeAttribute('aria-invalid');
      }

      inputs.forEach((element) => {
        const eventName = element.tagName === 'SELECT' ? 'change' : 'input';
        element.addEventListener(eventName, () => clearFieldError(element));
      });

      function showError(element, message) {
        if (!element) return;
        const container = element.closest('.field');
        if (!container) return;
        container.classList.add('error');
        const messageSlot = container.querySelector('.error-message');
        if (messageSlot) messageSlot.textContent = message;
        element.setAttribute('aria-invalid', 'true');
      }

      function clearErrors() {
        form.querySelectorAll('.field.error').forEach((container) => {
          container.classList.remove('error');
          const message = container.querySelector('.error-message');
          if (message) message.textContent = '';
          const control = container.querySelector('input, select');
          control?.removeAttribute('aria-invalid');
        });
      }

      function collectStep1() {
        clearErrors();

        let isValid = true;
        const name = (fields.name?.value ?? '').trim();
        const email = (fields.email?.value ?? '').trim();
        const ageValue = (fields.age?.value ?? '').trim();
        const gender = fields.gender?.value ?? '';
        const password = fields.password?.value ?? '';
        const confirm = fields.confirm?.value ?? '';

        if (!name) {
          showError(fields.name, 'Name is required');
          isValid = false;
        }

        if (!email) {
          showError(fields.email, 'Email is required');
          isValid = false;
        } else {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(email)) {
            showError(fields.email, 'Enter a valid email address');
            isValid = false;
          }
        }

        if (!ageValue) {
          showError(fields.age, 'Age is required');
          isValid = false;
        } else {
          const ageNumber = Number(ageValue);
          if (!Number.isFinite(ageNumber) || ageNumber < 1 || ageNumber > 120) {
            showError(fields.age, 'Enter an age between 1 and 120');
            isValid = false;
          }
        }

        if (!gender) {
          showError(fields.gender, 'Please select your gender');
          isValid = false;
        }

        if (!password) {
          showError(fields.password, 'Password is required');
          isValid = false;
        } else if (password.length < 6) {
          showError(fields.password, 'Use at least 6 characters');
          isValid = false;
        }

        if (!confirm) {
          showError(fields.confirm, 'Confirm your password');
          isValid = false;
        } else if (password && confirm !== password) {
          showError(fields.confirm, 'Passwords do not match');
          isValid = false;
        }

        if (!isValid) {
          const firstInvalid = form.querySelector('.field.error input, .field.error select');
          firstInvalid?.focus();
          return false;
        }

        window.FFAuth.saveStep1({ name, email, age: ageValue, gender, password });
        return true;
      }

      nextLink?.addEventListener('click', (event) => {
        if (!collectStep1()) {
          event.preventDefault();
        }
      });
    }
  </script>
</body>
</html>
